(function(x){var p=function(e,a){var t=[],r;for(r=0;r<e;r+=1){t[r]=a+r}return t};var z=function(o,e){var c="";x.each(e,function(e,t){var a=/\{(.*?)\}/g;var r=o.match(a),n;var i=o;x.each(r,function(e,a){n=a.replace(/\{(.*?)\}/g,"$1");i=i.replace(a,l(t,n)?t[n]:"<span style='color:red'>无此字段："+n+"</span>")});c+=i});return c};function l(e,a){return e.hasOwnProperty(a)&&a in e}var M=function(e){var a={currentPage:1,pageSize:20,totalRecords:0,pageTemplate:"<div>当前页: [page:page], 总页数: [page:pages]，<ul class='pageNav'>[page:pageLink]</ul></div>",pageLinkTemplate:"<li data-page='[page:pageNum]'>[page:pageNum]</li>"};x.extend(a,e);return function(t){var e=Math.ceil(t.totalRecords/t.pageSize);if(e<2)return;var a=t.pageTemplate;var r="";var n="";var i="";var o="";var c="";var l="";var g="";if(!(e>10)){n=p(e,1)}if(e>10){if(t.currentPage<=10){n=p(10,1)}if(t.currentPage>10){if(t.currentPage<=e-5){n=p(10,t.currentPage-4)}else{n=p(10,e-9)}}}x.each(n,function(e,a){g+=t.pageLinkTemplate.replace(/\[page:pageNum\]/g,a)});c="<li data-page='[page:pageNum]'>&lt;&lt;</li>".replace(/\[page:pageNum\]/g,1);i="<li data-page='[page:pageNum]'>&lt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)-1);o="<li data-page='[page:pageNum]'>&gt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)+1>e?e:parseInt(t.currentPage)+1);l="<li data-page='[page:pageNum]'>&gt;&gt;</li>".replace(/\[page:pageNum\]/g,e);if(t.currentPage===1){c="";i=""}if(parseInt(t.currentPage)===e){o="";l=""}r=c+i+g+o+l;a=a.replace(/\[page\:pages\]/g,e).replace(/\[page\:page\]/g,t.currentPage?t.currentPage:1).replace(/\[page\:pageLink\]/g,r);return a}(a)};var e=function(){};var a={init:function(){},list:function(e,h,y){var P={isPage:false,isMobile:false,pageSize:20,currentPage:1,totalRecords:0};P.isMobile=/(iemobile|iphone|ipod|android|nokia|sonyericsson|blackberry|samsung|sec\-|windows ce|motorola|mot\-|up.b|midp\-)/gi.test(navigator.appVersion);x.extend(P,e);var b="#"+this.attr("id");var a=b+"Template";var S="";if(x(a)[0]){S=x(a).html()}else{S=x(b).html();x("body").append("<div id='"+a.slice(1)+"' class='hide'></div>");x(a).html(S)}var t="<div class='loading'>"+x(b).attr("data-loadInfo")+"</div>";if(P.currentPage==1){x(b).html(t).removeClass("hide")}var N=function(e,a){var t=x(b).attr("data-jsonUrl");if(t.indexOf("page")>-1){t=t.replace(/page=(\d+)*/g,"page="+e)}else{if(t.indexOf("?")>-1){t=t+"&page="+e}else{t=t+"?page="+e}}if(t.indexOf("pageSize")>-1){t=t.replace(/pageSize=(\d+)*/g,"pageSize="+a)}else{if(t.indexOf("?")>-1){t=t+"&pageSize="+a}else{t=t+"?pageSize="+a}}return t};var r=this.attr("data-jsonurl");r=N(P.currentPage,P.pageSize);x.getJSON(r,function(e){if(typeof y=="function"){y(e)}var a=z(S,e.data);P.totalRecords=e.totalRecord;if(P.isMobile&&P.currentPage>1){x(b).prev(".loading").remove();x(b).append(a)}else{x(b).prev(".loading").remove();x(b).html(a)}if(P.isPage){var t=Math.ceil(P.totalRecords/P.pageSize);P.totalRecords=e.totalRecord;if(P.isMobile){var r=function(){var e=0,a=0,t=0;if(document.body){a=document.body.scrollTop}if(document.documentElement){t=document.documentElement.scrollTop}e=a-t>0?a:t;return e};var n=function(){var e=0;if(document.compatMode=="CSS1Compat"){e=document.documentElement.clientHeight}else{e=document.body.clientHeight}return e};var i=function(){var e=0,a=0,t=0;if(document.body){a=document.body.scrollHeight}if(document.documentElement){t=document.documentElement.scrollHeight}e=a-t>0?a:t;return e};var o=function(){setTimeout(function(){x(b).next().remove()},1e3)};var c=function(){if(P.currentPage<t){if(!x(".loading")[0]){x(b).html("<div class='loading'>载入中……</div>")}}else{if(!x(b).next().hasClass("loadEnd")){x(b).after("<div class='loadEnd'>已经是底部</div>")}}};var l=function(){if(P.currentPage<t){var e=N(P.currentPage,P.pageSize);x(b).attr("data-jsonUrl",N(P.currentPage,P.pageSize));x("body").unbind("touchend");P.currentPage+=1;x(b).bindJSON("list",P,h)}};var g=function(){if(r()<n()&&P.currentPage===1&&t>1){var e=N(2,P.pageSize);x(b).attr("data-jsonUrl",e);P.currentPage=2;x(b).bindJSON("list",P,h)}};var p=document.querySelector("body");var d,u,s,f,v;p.addEventListener("touchstart",function(e){var a=e.touches[0];d={x:a.pageX,y:a.pageY}});x("body").bind("touchend",function(e){var a=e.changedTouches[0];u={x:a.pageX,y:a.pageY};s=u.x-d.x;f=u.y-d.y;v=Math.sqrt(Math.pow(Math.abs(s),2)+Math.pow(Math.abs(f),2));if(f<-10){if(i()==r()+n()){c();l();o()}}});g()}else{var m=M(P);x(b).next().remove();x(b).after(m);x(b).next().find("li[data-page='"+P.currentPage+"']").addClass("currentPage");x(b).next().find("li").on("click",function(){var e=x(this).attr("data-page");var a=N(e,P.pageSize);x(b).attr("data-jsonUrl",a);P.currentPage=parseInt(e);if(!x(this).hasClass("currentPage")){x(b).bindJSON("list",P,h)}})}}if(typeof h==="function"){h(e);x(b).removeAttr("style")}})},detail:function(e,n,i){var o=this;var a=this.attr("data-jsonUrl");x.getJSON(a,function(t){if(typeof i==="function"){i(t)}var r=o.html();var e=/\{(.*?)\}/g;var a=r.match(e);x.each(a,function(e,a){strFieldName=a.replace(/\{(.*?)\}/g,"$1");r=r.replace(a,l(t.data,strFieldName)?t.data[strFieldName]:"<span style='color:red'>无此字段："+strFieldName+"</span>")});o.html(r);o.removeClass("hide");if(typeof n==="function"){n(t)}})}};x.fn.bindJSON=function(){var e=arguments[0];if(a[e]){e=a[e];arguments=Array.prototype.slice.call(arguments,1)}else if(typeof e=="object"||!e){e=a.init}else{x.error("Method "+e+" does not exist on jQuery.bindJSON")}e.apply(this,arguments);return this}})(jQuery);