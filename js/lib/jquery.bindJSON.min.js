!function(S){var N=function(e,a){var t,n=[];for(t=0;t<e;t+=1)n[t]=a+t;return n};function x(e,a){return e.hasOwnProperty(a)&&a in e}var a={init:function(){},list:function(e,h,f){var v={isPage:!1,isMobile:!1,pageSize:20,currentPage:1,totalRecords:0};v.isMobile=/(iemobile|iphone|ipod|android|nokia|sonyericsson|blackberry|samsung|sec\-|windows ce|motorola|mot\-|up.b|midp\-)/gi.test(navigator.appVersion),S.extend(v,e);var y="#"+this.attr("id"),a=y+"Template",P="";S(a)[0]?P=S(a).html():(P=S(y).html(),S("body").append("<div id='"+a.slice(1)+"' class='hide'></div>"),S(a).html(P));var t="<div class='loading'>"+S(y).attr("data-loadInfo")+"</div>";1==v.currentPage&&S(y).html(t).removeClass("hide");var b=function(e,a){var t=S(y).attr("data-jsonUrl");return t=-1<(t=-1<t.indexOf("page")?t.replace(/page=(\d+)*/g,"page="+e):-1<t.indexOf("?")?t+"&page="+e:t+"?page="+e).indexOf("pageSize")?t.replace(/pageSize=(\d+)*/g,"pageSize="+a):-1<t.indexOf("?")?t+"&pageSize="+a:t+"?pageSize="+a},n=this.attr("data-jsonurl");n=b(v.currentPage,v.pageSize),S.getJSON(n,function(e){"function"==typeof f&&f(e);var i,a,o,t,n,r=(i=P,a=e.data,o="",S.each(a,function(e,t){var n,a=i.match(/\{(.*?)\}/g),r=i;S.each(a,function(e,a){n=a.replace(/\{(.*?)\}/g,"$1"),r=r.replace(a,x(t,n)?t[n]:"<span style='color:red'>无此字段："+n+"</span>")}),o+=r}),o);if(v.totalRecords=e.totalRecord,v.isMobile&&1<v.currentPage?(S(y).prev(".loading").remove(),S(y).append(r)):(S(y).prev(".loading").remove(),S(y).html(r)),v.isPage){var c=Math.ceil(v.totalRecords/v.pageSize);if(v.totalRecords=e.totalRecord,v.isMobile){var g,p,l,d,s=function(){var e=0,a=0;return document.body&&(e=document.body.scrollTop),document.documentElement&&(a=document.documentElement.scrollTop),0<e-a?e:a},u=function(){return"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight};document.querySelector("body").addEventListener("touchstart",function(e){var a=e.touches[0];g={x:a.pageX,y:a.pageY}}),S("body").bind("touchend",function(e){var a,t,n=e.changedTouches[0];p={x:n.pageX,y:n.pageY},l=p.x-g.x,d=p.y-g.y,Math.sqrt(Math.pow(Math.abs(l),2)+Math.pow(Math.abs(d),2)),d<-10&&(t=a=0,document.body&&(a=document.body.scrollHeight),document.documentElement&&(t=document.documentElement.scrollHeight),(0<a-t?a:t)==s()+u()&&(v.currentPage<c?S(".loading")[0]||S(y).html("<div class='loading'>载入中……</div>"):S(y).next().hasClass("loadEnd")||S(y).after("<div class='loadEnd'>已经是底部</div>"),v.currentPage<c&&(b(v.currentPage,v.pageSize),S(y).attr("data-jsonUrl",b(v.currentPage,v.pageSize)),S("body").unbind("touchend"),v.currentPage+=1,S(y).bindJSON("list",v,h)),setTimeout(function(){S(y).next().remove()},1e3)))}),function(){if(s()<u()&&1===v.currentPage&&1<c){var e=b(2,v.pageSize);S(y).attr("data-jsonUrl",e),v.currentPage=2,S(y).bindJSON("list",v,h)}}()}else{var m=(t=v,n={currentPage:1,pageSize:20,totalRecords:0,pageTemplate:"<div>当前页: [page:page], 总页数: [page:pages]&nbsp;<ul class='pageNav'>[page:pageLink]</ul></div>",pageLinkTemplate:"<li data-page='[page:pageNum]'>[page:pageNum]</li>"},S.extend(n,t),function(t){var e=Math.ceil(t.totalRecords/t.pageSize);if(!(e<2)){var a,n=t.pageTemplate,r="",i="",o="",c="",g="",p="";return 10<e||(r=N(e,1)),10<e&&(t.currentPage<=10&&(r=N(10,1)),10<t.currentPage&&(r=t.currentPage<=e-5?N(10,t.currentPage-4):N(10,e-9))),S.each(r,function(e,a){p+=t.pageLinkTemplate.replace(/\[page:pageNum\]/g,a)}),c="<li data-page='[page:pageNum]'>&lt;&lt;</li>".replace(/\[page:pageNum\]/g,1),i="<li data-page='[page:pageNum]'>&lt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)-1),o="<li data-page='[page:pageNum]'>&gt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)+1>e?e:parseInt(t.currentPage)+1),g="<li data-page='[page:pageNum]'>&gt;&gt;</li>".replace(/\[page:pageNum\]/g,e),1===t.currentPage&&(i=c=""),parseInt(t.currentPage)===e&&(g=o=""),a=c+i+p+o+g,n=n.replace(/\[page\:pages\]/g,e).replace(/\[page\:page\]/g,t.currentPage?t.currentPage:1).replace(/\[page\:pageLink\]/g,a)}}(n));S(y).next().remove(),S(y).after(m),S(y).next().find("li[data-page='"+v.currentPage+"']").addClass("currentPage"),S(y).next().find("li").on("click",function(){var e=S(this).attr("data-page"),a=b(e,v.pageSize);S(y).attr("data-jsonUrl",a),v.currentPage=parseInt(e),S(this).hasClass("currentPage")||S(y).bindJSON("list",v,h)})}}"function"==typeof h&&(h(e),S(y).removeAttr("style"))})},detail:function(e,a,n){var r=this,t=this.attr("data-jsonUrl"),i=this.attr("data-loadinfo"),o=this.html();this.html(i),this.removeClass("hide"),S.getJSON(t,function(t){"function"==typeof n&&n(t);var e=o.match(/\{(.*?)\}/g);S.each(e,function(e,a){strFieldName=a.replace(/\{(.*?)\}/g,"$1"),o=o.replace(a,x(t.data,strFieldName)?t.data[strFieldName]:"<span style='color:red'>无此字段："+strFieldName+"</span>")}),r.html(o),r.removeClass("hide"),"function"==typeof a&&a(t)})}};S.fn.bindJSON=function(){var e=arguments[0];return a[e]?(e=a[e],arguments=Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?S.error("Method "+e+" does not exist on jQuery.bindJSON"):e=a.init,e.apply(this,arguments),this}}(jQuery);