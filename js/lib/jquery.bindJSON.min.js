(function(N){var p=function(e,a){var t=[],r;for(r=0;r<e;r+=1){t[r]=a+r}return t};var x=function(o,e){var l="";N.each(e,function(e,t){var a=/\{(.*?)\}/g;var r=o.match(a),n;var i=o;N.each(r,function(e,a){n=a.replace(/\{(.*?)\}/g,"$1");i=i.replace(a,c(t,n)?t[n]:"<span style='color:red'>无此字段："+n+"</span>")});l+=i});return l};function c(e,a){return e.hasOwnProperty(a)&&a in e}var z=function(e){var a={currentPage:1,pageSize:20,totalRecords:0,pageTemplate:"<div>当前页: [page:page], 总页数: [page:pages]，<ul class='pageNav'>[page:pageLink]</ul></div>",pageLinkTemplate:"<li data-page='[page:pageNum]'>[page:pageNum]</li>"};N.extend(a,e);return function(t){var e=Math.ceil(t.totalRecords/t.pageSize);if(e<2)return;var a=t.pageTemplate;var r="";var n="";var i="";var o="";var l="";var c="";var g="";if(!(e>10)){n=p(e,1)}if(e>10){if(t.currentPage<=10){n=p(10,1)}if(t.currentPage>10){if(t.currentPage<=e-5){n=p(10,t.currentPage-4)}else{n=p(10,e-9)}}}N.each(n,function(e,a){g+=t.pageLinkTemplate.replace(/\[page:pageNum\]/g,a)});l="<li data-page='[page:pageNum]'>&lt;&lt;</li>".replace(/\[page:pageNum\]/g,1);i="<li data-page='[page:pageNum]'>&lt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)-1);o="<li data-page='[page:pageNum]'>&gt;</li>".replace(/\[page:pageNum\]/g,parseInt(t.currentPage)+1>e?e:parseInt(t.currentPage)+1);c="<li data-page='[page:pageNum]'>&gt;&gt;</li>".replace(/\[page:pageNum\]/g,e);if(t.currentPage===1){l="";i=""}if(parseInt(t.currentPage)===e){o="";c=""}r=l+i+g+o+c;a=a.replace(/\[page\:pages\]/g,e).replace(/\[page\:page\]/g,t.currentPage?t.currentPage:1).replace(/\[page\:pageLink\]/g,r);return a}(a)};var e=function(){};var a={init:function(){},list:function(e,h){var P={isPage:false,isMobile:false,pageSize:20,currentPage:1,totalRecords:0};P.isMobile=/(iemobile|iphone|ipod|android|nokia|sonyericsson|blackberry|samsung|sec\-|windows ce|motorola|mot\-|up.b|midp\-)/gi.test(navigator.appVersion);N.extend(P,e);var y="#"+this.attr("id");var a=y+"Template";var b="";if(N(a)[0]){b=N(a).html()}else{b=N(y).html();N("body").append("<div id='"+a.slice(1)+"' class='hide'></div>");N(a).html(b)}var t="<div class='loading'>"+N(y).attr("data-loadInfo")+"</div>";if(P.currentPage==1){N(y).html(t).removeClass("hide")}var S=function(e,a){var t=N(y).attr("data-jsonUrl");if(t.indexOf("page")>-1){t=t.replace(/page=(\d+)*/g,"page="+e)}else{if(t.indexOf("?")>-1){t=t+"&page="+e}else{t=t+"?page="+e}}if(t.indexOf("pageSize")>-1){t=t.replace(/pageSize=(\d+)*/g,"pageSize="+a)}else{if(t.indexOf("?")>-1){t=t+"&pageSize="+a}else{t=t+"?pageSize="+a}}return t};var r=this.attr("data-jsonurl");r=S(P.currentPage,P.pageSize);N.getJSON(r,function(e){console.log(e);var a=x(b,e.data);P.totalRecords=e.totalRecord;if(P.isMobile&&P.currentPage>1){N(y).prev(".loading").remove();N(y).append(a)}else{N(y).prev(".loading").remove();N(y).html(a)}if(P.isPage){var t=Math.ceil(P.totalRecords/P.pageSize);P.totalRecords=e.totalRecord;if(P.isMobile){var r=function(){var e=0,a=0,t=0;if(document.body){a=document.body.scrollTop}if(document.documentElement){t=document.documentElement.scrollTop}e=a-t>0?a:t;return e};var n=function(){var e=0;if(document.compatMode=="CSS1Compat"){e=document.documentElement.clientHeight}else{e=document.body.clientHeight}return e};var i=function(){var e=0,a=0,t=0;if(document.body){a=document.body.scrollHeight}if(document.documentElement){t=document.documentElement.scrollHeight}e=a-t>0?a:t;return e};var o=function(){setTimeout(function(){N(y).next().remove()},1e3)};var l=function(){if(P.currentPage<t){if(!N(".loading")[0]){N(y).html("<div class='loading'>载入中……</div>")}}else{if(!N(y).next().hasClass("loadEnd")){N(y).after("<div class='loadEnd'>已经是底部</div>")}}};var c=function(){if(P.currentPage<t){var e=S(P.currentPage,P.pageSize);N(y).attr("data-jsonUrl",S(P.currentPage,P.pageSize));N("body").unbind("touchend");P.currentPage+=1;N(y).bindJSON("list",P,h)}};var g=function(){if(r()<n()&&P.currentPage===1&&t>1){var e=S(2,P.pageSize);N(y).attr("data-jsonUrl",e);P.currentPage=2;N(y).bindJSON("list",P,h)}};var p=document.querySelector("body");var d,s,u,f,v;p.addEventListener("touchstart",function(e){var a=e.touches[0];d={x:a.pageX,y:a.pageY}});N("body").bind("touchend",function(e){var a=e.changedTouches[0];s={x:a.pageX,y:a.pageY};u=s.x-d.x;f=s.y-d.y;v=Math.sqrt(Math.pow(Math.abs(u),2)+Math.pow(Math.abs(f),2));console.log(v);if(f<-10){if(i()==r()+n()){l();c();o()}}});g()}else{var m=z(P);N(y).next().remove();N(y).after(m);N(y).next().find("li[data-page='"+P.currentPage+"']").addClass("currentPage");N(y).next().find("li").on("click",function(){var e=N(this).attr("data-page");var a=S(e,P.pageSize);N(y).attr("data-jsonUrl",a);P.currentPage=parseInt(e);if(!N(this).hasClass("currentPage")){N(y).bindJSON("list",P,h)}})}}if(typeof h==="function"){h(e);N(y).removeAttr("style")}})},detail:function(e,n){var i=this;var a=this.attr("data-jsonUrl");N.getJSON(a,function(t){var r=i.html();var e=/\{(.*?)\}/g;var a=r.match(e);N.each(a,function(e,a){strFieldName=a.replace(/\{(.*?)\}/g,"$1");r=r.replace(a,c(t.data,strFieldName)?t.data[strFieldName]:"<span style='color:red'>无此字段："+strFieldName+"</span>")});i.html(r);i.removeClass("hide");if(typeof n==="function"){n()}})}};N.fn.bindJSON=function(){var e=arguments[0];if(a[e]){e=a[e];arguments=Array.prototype.slice.call(arguments,1)}else if(typeof e=="object"||!e){e=a.init}else{N.error("Method "+e+" does not exist on jQuery.bindJSON")}e.apply(this,arguments);return this}})(jQuery);